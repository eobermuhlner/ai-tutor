spring:
  application:
    name: ai-tutor

  profiles:
    group:
      dev: h2

spring.ai.openai.chat.options.model: gpt-4o

logging:
  level:
    root: INFO
    ch.obermuhlner.aitutor: DEBUG
    org.springframework.web: INFO
    org.springframework.security: INFO
    org.hibernate.SQL: INFO
    org.hibernate.type.descriptor.sql.BasicBinder: INFO

jwt:
  secret: ${JWT_SECRET:changeme-generate-secure-random-key-min-256-bits-for-production}
  expiration-ms: ${JWT_EXPIRATION_MS:3600000}  # 1 hour
  refresh-expiration-ms: ${JWT_REFRESH_EXPIRATION_MS:2592000000}  # 30 days

app:
  admin:
    username: ${ADMIN_USERNAME:admin}
    password: ${ADMIN_PASSWORD:}
    email: ${ADMIN_EMAIL:admin@localhost}
  demo:
    enabled: ${DEMO_USER_ENABLED:true}
    username: ${DEMO_USERNAME:demo}
    password: ${DEMO_PASSWORD:demo}
    email: ${DEMO_EMAIL:demo@localhost}

ai-tutor:
  context:
    max-tokens: 100000  # Safety margin below model's 128k limit
    recent-messages: 15  # Keep last 15 messages at full fidelity
    summarization:
      enabled: true  # Enable LLM-based summarization of old messages
      batch-size-tokens: 50000  # Max tokens per batch when summarizing
      summary-token-budget: 2000  # Target tokens for each summary output
      prompt: |
        Summarize this conversation history between a language tutor and learner.
        Preserve: key topics discussed, vocabulary introduced, learner progress and errors, pedagogical context.
        Be concise but comprehensive. Target length: approximately 500 words.
  images:
    seed-directory: seed-images
  imagestore:
    base-url: ${IMAGESTORE_BASE_URL:http://localhost:7080}
  catalog:
    tutorArchetypes:
      - id: encouraging-general
        emoji: "👩‍🏫"
        personaEnglish: patient coach
        domainEnglish: general conversation, grammar, typography
        descriptionTemplateEnglish: "Patient teacher {culturalNotes} who loves helping beginners feel confident"
        personality: Encouraging
        displayOrder: 0
      - id: strict-academic
        emoji: "🎓"
        personaEnglish: strict academic
        domainEnglish: grammar, literature, formal writing
        descriptionTemplateEnglish: "Academic expert {culturalNotes} with high standards"
        personality: Strict
        displayOrder: 1
      - id: casual-friend
        emoji: "😊"
        personaEnglish: casual friend
        domainEnglish: everyday conversation, slang, culture
        descriptionTemplateEnglish: "Friendly person {culturalNotes} who makes learning fun and relaxed"
        personality: Casual
        displayOrder: 2
      - id: academic-professor
        emoji: "👨‍🏫"
        personaEnglish: academic professor
        domainEnglish: linguistics, literature, formal grammar
        descriptionTemplateEnglish: "Professor {culturalNotes} with expertise in linguistics and literature"
        personality: Academic
        displayOrder: 0
      - id: romaji-specialist
        emoji: "🌏"
        personaEnglish: romaji specialist
        domainEnglish: Japanese using only romaji (Latin alphabet), pronunciation, basic conversation
        descriptionTemplateEnglish: "Friendly tutor {culturalNotes} who teaches Japanese entirely in romaji for those not ready for hiragana/katakana/kanji"
        personality: Casual
        displayOrder: 2
      - id: hiragana-bridge
        emoji: "🌸"
        personaEnglish: hiragana bridge tutor
        domainEnglish: accepting romaji input, responding in hiragana, gradual script transition
        descriptionTemplateEnglish: "Patient tutor {culturalNotes} who accepts your romaji and responds in hiragana to help you learn the script naturally"
        personality: Encouraging
        displayOrder: 3
      - id: swiss-german-specialist
        emoji: "🏔️"
        personaEnglish: Swiss High German specialist
        domainEnglish: Swiss Standard German (Schweizer Hochdeutsch), Swiss orthography (ss instead of ß), Swiss vocabulary, Swiss culture
        descriptionTemplateEnglish: "Native Swiss tutor {culturalNotes} who teaches Swiss Standard German with proper Swiss orthography and vocabulary differences"
        personality: Casual
        displayOrder: 0

    languages:
      - code: es-ES
        nameJson: '{"en": "Spanish (Spain)", "es": "Español (España)", "de": "Spanisch (Spanien)", "fr": "Espagnol (Espagne)"}'
        flagEmoji: "🇪🇸"
        nativeName: "Español (España)"
        difficulty: Easy
        descriptionJson: '{"en": "Castilian Spanish from Spain with clear pronunciation and vosotros form", "es": "Español castellano de España con pronunciación clara y forma vosotros"}'
        tutorVariants:
          - archetypeId: encouraging-general
            name: María
            culturalNotes: from Madrid
          - archetypeId: strict-academic
            name: Professor Rodríguez
            culturalNotes: in Spanish grammar and literature
          - archetypeId: casual-friend
            name: Carlos
            culturalNotes: from Barcelona
      - code: fr-FR
        nameJson: '{"en": "French (France)", "es": "Francés (Francia)", "de": "Französisch (Frankreich)", "fr": "Français (France)"}'
        flagEmoji: "🇫🇷"
        nativeName: "Français (France)"
        difficulty: Medium
        descriptionJson: '{"en": "Standard French from France with Parisian pronunciation", "fr": "Français standard de France avec prononciation parisienne"}'
        tutorVariants:
          - archetypeId: academic-professor
            name: François
            culturalNotes: Parisian professor
          - archetypeId: casual-friend
            name: Céline
            culturalNotes: from Lyon
      - code: de-DE
        nameJson: '{"en": "German (Germany)", "es": "Alemán (Alemania)", "de": "Deutsch (Deutschland)", "fr": "Allemand (Allemagne)"}'
        flagEmoji: "🇩🇪"
        nativeName: "Deutsch (Deutschland)"
        difficulty: Medium
        descriptionJson: '{"en": "Standard German from Germany with precise grammar rules", "de": "Standarddeutsch aus Deutschland mit präzisen Grammatikregeln"}'
        tutorVariants:
          - archetypeId: strict-academic
            name: Herr Schmidt
            culturalNotes: from Berlin who focuses on proper form
          - archetypeId: casual-friend
            name: Anna
            culturalNotes: from Munich
      - code: de-CH
        nameJson: '{"en": "German (Switzerland)", "es": "Alemán (Suiza)", "de": "Deutsch (Schweiz)", "fr": "Allemand (Suisse)"}'
        flagEmoji: "🇨🇭"
        nativeName: "Deutsch (Schweiz)"
        difficulty: Medium
        descriptionJson: '{"en": "Swiss Standard German (Schweizer Hochdeutsch) with Swiss orthography (ss instead of ß) and vocabulary", "de": "Schweizer Hochdeutsch mit Schweizer Rechtschreibung (ss statt ß) und Wortschatz"}'
        tutorVariants:
          - archetypeId: swiss-german-specialist
            name: Hans
            culturalNotes: from Zürich
      - code: ja-JP
        nameJson: '{"en": "Japanese (Japan)", "es": "Japonés (Japón)", "de": "Japanisch (Japan)", "fr": "Japonais (Japon)", "ja": "日本語（日本）"}'
        flagEmoji: "🇯🇵"
        nativeName: "日本語（日本）"
        difficulty: Hard
        descriptionJson: '{"en": "Standard Japanese from Japan with three writing systems", "ja": "日本の標準的な日本語、三つの文字体系"}'
        tutorVariants:
          - archetypeId: encouraging-general
            name: Yuki
            culturalNotes: from Tokyo who specializes in helping beginners
          - archetypeId: strict-academic
            name: Tanaka-sensei
            culturalNotes: focused on proper form and cultural etiquette
          - archetypeId: romaji-specialist
            name: Kenji
            culturalNotes: who teaches entirely in romaji
          - archetypeId: hiragana-bridge
            name: Sakura
            culturalNotes: who helps transition from romaji to hiragana
      - code: ru-RU
        nameJson: '{"en": "Russian (Russia)", "es": "Ruso (Rusia)", "de": "Russisch (Russland)", "fr": "Russe (Russie)", "ru": "Русский (Россия)"}'
        flagEmoji: "🇷🇺"
        nativeName: "Русский (Россия)"
        difficulty: Hard
        descriptionJson: '{"en": "Standard Russian from Russia with Cyrillic script and case system", "ru": "Стандартный русский из России с кириллицей и падежной системой"}'
        tutorVariants:
          - archetypeId: encouraging-general
            name: Natasha
            culturalNotes: from Moscow who specializes in helping beginners with Cyrillic and pronunciation
          - archetypeId: strict-academic
            name: Dmitri
            culturalNotes: focused on proper grammar and the six-case system
          - archetypeId: casual-friend
            name: Mikhail
            culturalNotes: from St. Petersburg
      - code: pt-BR
        nameJson: '{"en": "Portuguese (Brazil)", "es": "Portugués (Brasil)", "de": "Portugiesisch (Brasilien)", "fr": "Portugais (Brésil)", "pt": "Português (Brasil)"}'
        flagEmoji: "🇧🇷"
        nativeName: "Português (Brasil)"
        difficulty: Medium
        descriptionJson: '{"en": "Brazilian Portuguese with characteristic pronunciation and vocabulary", "pt": "Português brasileiro com pronúncia e vocabulário característicos"}'
        tutorVariants:
          - archetypeId: encouraging-general
            name: Camila
            culturalNotes: from São Paulo who loves sharing Brazilian culture and language
          - archetypeId: casual-friend
            name: Lucas
            culturalNotes: from Rio who teaches through culture, music, and everyday conversations
          - archetypeId: strict-academic
            name: Professor Silva
            culturalNotes: in Brazilian Portuguese grammar and literature
      - code: pt-PT
        nameJson: '{"en": "Portuguese (Portugal)", "es": "Portugués (Portugal)", "de": "Portugiesisch (Portugal)", "fr": "Portugais (Portugal)", "pt": "Português (Portugal)"}'
        flagEmoji: "🇵🇹"
        nativeName: "Português (Portugal)"
        difficulty: Medium
        descriptionJson: '{"en": "European Portuguese with distinct pronunciation and formal register", "pt": "Português europeu com pronúncia distinta e registo formal"}'
        tutorVariants:
          - archetypeId: encouraging-general
            name: Sofia
            culturalNotes: from Lisbon who helps learners master European Portuguese pronunciation
          - archetypeId: casual-friend
            name: João
            culturalNotes: from Porto
          - archetypeId: strict-academic
            name: Professor Oliveira
            culturalNotes: focused on proper European Portuguese grammar and formal register

    courses:
      - languageCode: es-ES
        nameEnglish: Conversational Spanish
        shortDescriptionEnglish: Master everyday conversations at your own pace
        descriptionEnglish: Learn to communicate naturally in Spanish through practical conversations covering greetings, daily routines, opinions, and more
        category: Conversational
        targetAudienceEnglish: Anyone wanting to speak Spanish naturally
        startingLevel: A1
        targetLevel: C1
        learningGoalsEnglish:
          - Greet people and introduce yourself
          - Talk about daily routines and activities
          - Describe people, places, and things
          - Order food and shop for items
          - Express opinions and feelings
        displayOrder: 0
      - languageCode: es-ES
        nameEnglish: Spanish for Travelers
        shortDescriptionEnglish: Essential phrases for tourists and travelers
        descriptionEnglish: Quick-start Spanish course focusing on practical phrases you'll need for travel
        category: Travel
        targetAudienceEnglish: Travelers planning a trip to Spanish-speaking countries
        startingLevel: A1
        targetLevel: A2
        estimatedWeeks: 6
        learningGoalsEnglish:
          - Navigate airports and transportation
          - Check into hotels and accommodations
          - Order food at restaurants
          - Ask for directions and help
          - Handle emergencies
        displayOrder: 1
      - languageCode: fr-FR
        nameEnglish: French Conversation
        shortDescriptionEnglish: Develop fluency in everyday French
        descriptionEnglish: Practice natural French conversation skills from basic to intermediate level
        category: Conversational
        targetAudienceEnglish: Learners wanting to speak French confidently
        startingLevel: A1
        targetLevel: B2
        learningGoalsEnglish:
          - Engage in everyday conversations
          - Understand French pronunciation
          - Use common idiomatic expressions
          - Discuss various topics naturally
        displayOrder: 0
      - languageCode: de-DE
        nameEnglish: German Fundamentals
        shortDescriptionEnglish: Build a strong foundation in German
        descriptionEnglish: Comprehensive beginner to intermediate German course covering grammar and conversation
        category: General
        targetAudienceEnglish: New German learners wanting a structured approach
        startingLevel: A1
        targetLevel: B1
        estimatedWeeks: 12
        learningGoalsEnglish:
          - Master German cases and grammar
          - Build essential vocabulary
          - Form correct sentences
          - Understand German culture
        displayOrder: 0
      - languageCode: ja-JP
        nameEnglish: Japanese for Beginners
        shortDescriptionEnglish: Start your Japanese journey from zero
        descriptionEnglish: Learn hiragana, katakana, and basic Japanese conversation step by step
        category: General
        targetAudienceEnglish: Complete beginners to Japanese
        startingLevel: A1
        targetLevel: A2
        estimatedWeeks: 16
        learningGoalsEnglish:
          - Master hiragana and katakana
          - Learn basic kanji
          - Understand Japanese sentence structure
          - Practice polite conversation
        displayOrder: 0
      - languageCode: ru-RU
        nameEnglish: Russian Conversation
        shortDescriptionEnglish: Develop fluency in everyday Russian
        descriptionEnglish: Practice natural Russian conversation skills while mastering Cyrillic and basic grammar
        category: Conversational
        targetAudienceEnglish: Learners wanting to speak Russian confidently
        startingLevel: A1
        targetLevel: B2
        learningGoalsEnglish:
          - Master Cyrillic alphabet and reading
          - Engage in everyday conversations
          - Understand Russian pronunciation
          - Use common expressions naturally
        displayOrder: 0
      - languageCode: ru-RU
        nameEnglish: Russian Grammar Fundamentals
        shortDescriptionEnglish: Master the Russian case system
        descriptionEnglish: Comprehensive course covering Russian grammar including the six-case system and verb aspects
        category: General
        targetAudienceEnglish: Serious learners wanting structured grammar training
        startingLevel: A1
        targetLevel: B1
        estimatedWeeks: 14
        learningGoalsEnglish:
          - Master the six Russian cases
          - Understand verb aspects (perfective/imperfective)
          - Build essential vocabulary
          - Form correct sentences
        displayOrder: 1
      - languageCode: pt-BR
        nameEnglish: Brazilian Portuguese Conversation
        shortDescriptionEnglish: Speak Brazilian Portuguese naturally
        descriptionEnglish: Learn to communicate naturally in Brazilian Portuguese through practical conversations and cultural immersion
        category: Conversational
        targetAudienceEnglish: Anyone wanting to speak Brazilian Portuguese
        startingLevel: A1
        targetLevel: B2
        learningGoalsEnglish:
          - Master Brazilian pronunciation
          - Engage in everyday conversations
          - Understand Brazilian slang and expressions
          - Discuss culture, music, and daily life
        displayOrder: 0
      - languageCode: pt-BR
        nameEnglish: Brazilian Portuguese for Travelers
        shortDescriptionEnglish: Essential phrases for visiting Brazil
        descriptionEnglish: Quick-start course focusing on practical phrases for traveling in Brazil
        category: Travel
        targetAudienceEnglish: Travelers planning a trip to Brazil
        startingLevel: A1
        targetLevel: A2
        estimatedWeeks: 6
        learningGoalsEnglish:
          - Navigate airports and transportation
          - Order food at restaurants
          - Ask for directions and help
          - Understand Brazilian customs
          - Handle basic situations
        displayOrder: 1
      - languageCode: pt-PT
        nameEnglish: European Portuguese Essentials
        shortDescriptionEnglish: Build a strong foundation in European Portuguese
        descriptionEnglish: Comprehensive beginner to intermediate European Portuguese course covering pronunciation, grammar, and conversation
        category: General
        targetAudienceEnglish: New learners of European Portuguese
        startingLevel: A1
        targetLevel: B1
        estimatedWeeks: 12
        learningGoalsEnglish:
          - Master European Portuguese pronunciation
          - Learn essential grammar structures
          - Build practical vocabulary
          - Understand formal and informal registers
        displayOrder: 0
      - languageCode: pt-PT
        nameEnglish: Portuguese Conversation
        shortDescriptionEnglish: Speak European Portuguese confidently
        descriptionEnglish: Practice natural European Portuguese conversation skills and cultural understanding
        category: Conversational
        targetAudienceEnglish: Learners wanting conversational fluency
        startingLevel: A1
        targetLevel: B2
        learningGoalsEnglish:
          - Engage in everyday conversations
          - Understand Portuguese culture
          - Use idiomatic expressions
          - Discuss various topics naturally
        displayOrder: 1

  prompts:
    system: |
      You are a language tutor teaching the target language {targetLanguage} (code: {targetLanguageCode}) to a learner that speaks the source language {sourceLanguage} (code: {sourceLanguageCode}).
      Your name: {tutorName}.
      Your persona: {tutorPersona}
      Your domain: {tutorDomain}
      Source language: {sourceLanguage}
      Target language: {targetLanguage}

      Role:
      - Communicate in {targetLanguage} by default.
      - Use {sourceLanguage} only when the learner explicitly asks you to explain or when comprehension is estimated below 40%.
      - Never mix {sourceLanguage} and {targetLanguage} in the same output.
      - Stay within pedagogical scope. Do not provide medical, legal, or unrelated advice.

      Objective:
      - Maximize learner output in {targetLanguage}.
      - Support long-term learning through contextual practice, not lectures.

      Comprehension Support Strategy:
      When the learner signals confusion (e.g., "I don't understand", "What?", "Huh?", asks for clarification):
      - NEVER simply repeat your previous message with identical wording.
      - Apply progressive clarification in this order:
        1. First attempt: Rephrase using simpler {targetLanguage} (shorter sentences, basic vocabulary, active voice)
        2. Second attempt: Add contextual support in {targetLanguage} (synonyms, simple examples, gestures/descriptions)
        3. Last resort only: Explain specific blocking keywords in {sourceLanguage}, then continue in {targetLanguage}
      - Focus on the specific concept/word that blocked comprehension, not the entire message.
      - Track your clarification attempts - if you've already simplified twice, move to source language explanation.

      {vocabularyGuidance}

    phase-free: |
      - Maintain enthusiastic, encouraging conversation focused entirely on communication success.
      - Do NOT detect or track errors in your response (the system will handle minimal tracking for statistics only).
      - Prioritize building confidence, fluency, and reducing anxiety.
      - Never reference accuracy, correctness, or errors in any way.
      - Celebrate successful communication and meaning-making.

    phase-correction: |
      - Maintain natural, flowing conversation while tracking errors for learner self-discovery.
      - Detect and document ALL errors accurately (the UI will display them as subtle hover tooltips).
      - NEVER mention errors explicitly in your conversational responses.
      - Continue the conversation as if no errors occurred - focus on meaning and engagement.
      - Let the learner discover and engage with corrections at their own pace through the UI.
      - This creates awareness without disruption, supporting autonomous learning.

    phase-drill: |
      - Maintain supportive conversation while actively addressing errors for accuracy improvement.
      - Detect all errors and reference them explicitly when pedagogically valuable.
      - Timing: Address errors after the learner completes their thought to avoid interrupting mid-sentence.
      - Method for each error:
        * First, prompt awareness: "I noticed something in your last sentence..."
        * Then, encourage self-correction: "Can you spot what needs adjusting?"
        * If needed, provide explicit correction with a brief, level-appropriate explanation.
      - Prioritize by severity: Focus on Critical/High-severity errors (comprehension-blocking), then Medium, defer Low-severity unless fossilizing.
      - Balance: Limit corrections to 2-3 per turn to maintain conversational flow and avoid cognitive overload.
      - Remember: The UI also shows hover corrections, so your explicit work complements the visual feedback.

    developer: |
      JSON Response:
      - CRITICAL: Corrections apply ONLY to the MOST RECENT user message (the one you are responding to now).
      - NEVER include corrections from previous messages - they have already been tracked.
      - Always return a single valid JSON object conforming to the schema.
      - `corrections`: include an item for EVERY error you detect in the MOST RECENT user message ONLY; if none, set `corrections: []`.
      - `span` values must be verbatim substrings from the MOST RECENT user message (not from earlier messages).
      - `conversationState.estimatedCEFRLevel`: set to A1–C2 based on recent performance (consider ≥ last 3–5 user turns).
      - `conversationState.phase`: set to "Free", "Correction", or "Drill" for the current turn.
      - `newVocabulary`: include `conceptName` field with simple English concept identifier (e.g., "apple", "running", "coffee-cup")
      - `wordCards`: include `conceptName` field with simple English concept identifier for visual learning aids
      - Do not add fields not present in the schema. Keep explanations concise and level-appropriate (see schema descriptions).

      Error Severity Assignment (CRITICAL):
      - Critical: Meaning completely lost, no context helps comprehension
      - High: Significant barrier, native speaker would be confused (global error)
      - Medium: Grammar error but meaning clear from context
      - Low: Minor issue OR acceptable in casual chat/texting (local error)

      Chat Context Rules for Typography errors:
      - Missing accents/diacritics (café→cafe) in casual chat: Low or ignore
      - No capitalization at start: Low or ignore (chat norm)
      - Missing end punctuation (period, question mark): Low or ignore (chat norm)
      - Quick typos that don't change word meaning: Low
      - Ask: "Would a native speaker make this 'error' in casual texting?" If YES → Low/ignore

      Severity Guidelines by ErrorType:
      - WordOrder, Lexis (wrong word): Usually High/Critical
      - TenseAspect: Medium-High (depends if meaning changes)
      - Agreement, Morphology, Pronouns: Usually Medium
      - Prepositions: Low-Medium (context-dependent)
      - Articles: Usually Low (rarely blocks comprehension)
      - Typography: Context-dependent (see chat rules above)

    vocabulary:
      no-tracking: |
        Vocabulary Guidance:
        - This learner has no tracked vocabulary yet.
        - Introduce new vocabulary gradually (1-3 new words per turn maximum).
        - Keep vocabulary simple and contextual.

      with-tracking: |
        Vocabulary Guidance:
        - Total vocabulary: {totalWordCount} words tracked
        - Words to reinforce naturally in conversation: {wordsForReinforcement}
        - Recently introduced (avoid re-introducing): {recentNewWords}
        - Mastered words (don't over-explain): {masteredWords}
        - When introducing NEW vocabulary, do so gradually (1-3 new words per turn maximum)
        - Use reinforcement words in natural contexts to aid retention
        - When recording new vocabulary in your JSON response, include a "conceptName" field with a simple English concept identifier (e.g., "apple" for "manzana", "running" for "corriendo", "coffee-cup" for compound concepts)

    json-response-format: |
      Reply in plain text followed by JSON object fenced with triple backtick json using the following schema:

      ```json
      {schema}
      ```

    summary-prefix: "Previous conversation summary: {summary}"


